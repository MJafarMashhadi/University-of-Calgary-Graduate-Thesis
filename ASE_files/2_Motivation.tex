\section{Motivation} \label{sec:motivation}
% Paragraph 1: explain many examples in software industry where the developers reuse black-box units either as part of frameworks or libraries. you can even try to find some numbers about these reuse form literature.
Black-box components are ubiquitous in software development. Reusing high-quality black-box units generally offers a better overall system quality and a higher productivity \cite{edwards2001framework}.  The black-box units can be as small as a reusable library, or as large as a framework (such as .NET before going open-source), or a complete piece of software such as a remotely hosted web service. There are also scenarios where the unit's source code is not black-box in general, but not accessible to a specific team that wishes to perform the dynamic analysis. 

One particular interesting use case of system-level black-box analysis is inferring run-time state model of a control software systems, where inputs/outputs are signals to/from the system. These inputs/outputs are typically multivariate time series, which are already logged in such systems (no overhead for instrumentation). The goal is automatically detecting the high-level system state and its changes, over time.

As discussed in section~\ref{sec:intro}, we partnered with an auto-pilot manufacturer and performed this study on their auto-pilot software (called AutoPilot in this paper). The goal was to determine the state of AutoPilot from its input/output signals, over time. In this scenario, the inputs are the sensor readings going into AutoPilot and the outputs are command signals sent to controller motors of the aircraft, showing AutoPilot's reaction to each input at each state. A state in this example is the high-level stage of a flight and a state change happens when the current input values in the current state trigger a constraint in the implementation that changes the way the output signals are generated. % For example, going from the ``acceleration'' to the ``take-off'' state.

In this example, the training set will consist of input and output values recorded during one execution of the system, as a multivariate time series, along with state ids (as labels) per time stamp. One execution of the AutoPilot will be the whole flight process that may go through a ``take-off'' until a successful ``landing''. Depending on the flight plan, AutoPilot goes through states such as ``acceleration'', ``take-off'', ``climbing'', ``turning'', ``descending'', etc. 
%This is a part of the training example and it is what we are trying to predict. The input and output values which make a multivariate time series are the other part of the training example. Our approach aims to automate the task of labeling these states by learning from a training set.

% Paragraph4: motivate the use of a neural network and CNN/RNN to predict using this type of dataset (multivariate time series)

%In other words, the goal is to take the system's input/outputs as a multivariate time series and divide it up along the time axis. In each sub division the system is in one state so the points where it is split on mark state changes. 

During a flight, the AutoPilot monitors changes in the input values and makes adjustments to its outputs in order to hold some invariants (predefined rules). 
For example, if AutoPilot is in the ``hold altitude'' mode, it monitors the altimeter's readings and when it goes out of the acceptable range, proportionate adjustments to the throttle or the nose pitch will be made to get it back to the desired altitude. This is basically how a typical feedback loop controller, such as PID or its variations work \cite{feedbacksystemsBook}.
When AutoPilot's state changes from ``hold altitude'' to ``descend to X ft'' state, the set of invariants that AutoPilot is trying to hold are changed. It means its reactions to variations in inputs will be different. In this example, a decreasing altimeter reading will not trigger an increase in the throttle anymore.

Looking at the time series, a domain expert can identify what the state of AutoPilot is, at each point in time; the labeling process. Now the goal is to automate this task on a test set (in practice, future flights), assuming a training set is labeled by the experts (they only need to identify the state change time stamps, during a flight). 

This problem can be tackled in two ways. The first solution is to identify the time stamp that the state change happens (i.e., Change Point Detection: RQ1); The more advanced solution is to predict the exact state per time stamp (i.e., State Classification: RQ2). The classic CPD techniques on time series \cite{Truong2018ChangePointSurvey} are mainly applicable on univariate data or put assumptions on the input/output distributions, thus not applicable in our case with multivariate inputs and no assumptions or knowledge about the states' distribution. The classic state classification techniques in time series are also weak in that %they mainly use a sliding window to capture past patterns, which does not allow long memories.  
they fail to balance between considering long-term relations or acting locally. The ones that use a sliding window, for example, do not have a long-term memory. The ones that act on the whole data on the other hand are too coarse-grained and inaccurate for this task.

Therefore, the motivation for this study is to provide a black-box technique that can be applicable on both CPD and state classification problems, and overcome the limitations of the existing techniques, in terms of capturing the non-linear correlation between multivariate inputs and outputs as well as learning patterns over a long period of time. Our proposal, which will be explained in detail in section~\ref{sec:approach}, leverages the power of a deep neural network (DNN) with two types of layers that are particularly useful for this problem: a) convolutional layers which discover latent features from the data effectively through parameter sharing and b) recurrent layers that play a significant role in problems dealing with time series as they can learn long-term dependencies and seasonalities in the data. 

Though our motivational example, as well as our case study, are from the UAV auto-pilot domain, our proposed method can be adapted to be applied to similar black-box control software systems in domains such as IoT, intelligent video surveillance, and self-driving cars.